<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amor e Cacau | Pedidos</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --cor-vinho: #800020;
            --rosa-principal: #ff85a2;
            --marrom-chocolate: #4b2e2e;
            --bege-logo: #f7ede2;
            --verde-wpp: #25d366;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bege-logo); color: var(--marrom-chocolate); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        .tabs-nav { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; }
        .tab-btn { flex: none; padding: 10px 15px; border: none; background: #f0f0f0; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .tab-btn.active { background: var(--cor-vinho); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .cardapio-floral { text-align: center; padding: 20px; border: 2px solid var(--bege-logo); border-radius: 20px; background: #fffcf9; margin-bottom: 20px; }
        .card-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; border: 1px solid #eee; border-radius: 15px; margin-bottom: 10px; }
        
        .btn-acao { background: var(--cor-vinho); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .btn-ctrl { background: var(--cor-vinho); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-weight: bold; cursor: pointer; }

        /* √ÅREA FINALIZAR */
        .area-finalizar { margin-top: 20px; padding: 15px; border: 1px solid #eee; border-radius: 15px; background: #fafafa; }
        .btn-wpp { width: 100%; background: var(--verde-wpp); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-wpp:disabled { background: #ccc; }

        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; }
        .card-admin { background: #fff5f7; border: 1px solid var(--rosa-principal); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center; margin-bottom: 20px;">
        <h1 style="color: var(--cor-vinho); margin: 0;">‚ù§Ô∏è Amor e Cacau</h1>
    </header>

    <div class="tabs-nav">
        <button class="tab-btn active" onclick="abrirAba(event, 'aba-pronta')">Pronta Entrega</button>
        <button class="tab-btn" onclick="abrirAba(event, 'aba-cardapio')">Card√°pio</button>
        <button class="tab-btn" onclick="abrirAba(event, 'aba-combo')">Monte seu Combo</button>
        <button class="tab-btn" style="background: #fdf2f5;" onclick="abrirAba(event, 'aba-admin')">üë©‚Äçüç≥ Produ√ß√£o</button>
    </div>

    <div id="aba-pronta" class="tab-content active">
        <div id="lista-pronta"></div>
        <div class="area-finalizar">
            <input type="text" id="nome-pronta" placeholder="Seu Nome" oninput="validar('pronta')">
            <select id="entrega-pronta" onchange="validar('pronta')">
                <option value="">Como vai receber?</option>
                <option value="Retirada">Retirada</option>
                <option value="Uber Moto">Uber Moto</option>
            </select>
            <button id="btn-pronta" class="btn-wpp" onclick="finalizar('pronta')" disabled>Pedir no WhatsApp</button>
        </div>
    </div>

    <div id="aba-cardapio" class="tab-content">
        <div class="cardapio-floral">
            <h2 style="color: var(--cor-vinho)">Nossos Sabores</h2>
            <p>Tradicional ‚Ä¢ Caf√© ‚Ä¢ Lim√£o ‚Ä¢ Ferrero ‚Ä¢ Maracuj√° ‚Ä¢ Beijinho</p>
            <strong>R$ 3,00 a unidade</strong>
        </div>
    </div>

    <div id="aba-combo" class="tab-content">
        <h4 style="color: var(--cor-vinho)">üéÅ Combo 4 Doces (R$ 10,00)</h4>
        <div id="grid-combo" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px;"></div>
        <p id="selecionados-label">Selecionados: 0/4</p>
        
        <div class="area-finalizar">
            <input type="text" id="nome-combo" placeholder="Seu Nome" oninput="validar('combo')">
            <select id="entrega-combo" onchange="validar('combo')">
                <option value="">Como vai receber?</option>
                <option value="Retirada">Retirada</option>
                <option value="Uber Moto">Uber Moto</option>
            </select>
            <button id="btn-combo" class="btn-wpp" onclick="finalizar('combo')" disabled>Pedir Combo no WhatsApp</button>
        </div>
    </div>

    <div id="aba-admin" class="tab-content">
        <div class="card-admin">
            <h3>üìä Totais para Enrolar</h3>
            <div id="resumo-producao">Aguardando pedidos...</div>
        </div>
        <h4>Pedidos Pendentes</h4>
        <div id="pedidos-lista-admin"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDHcHj9p1CWXxJf14E9OIO1LJA4miwDGlo",
        authDomain: "amor-e-cacau.firebaseapp.com",
        projectId: "amor-e-cacau",
        storageBucket: "amor-e-cacau.firebasestorage.app",
        messagingSenderId: "766363119746",
        appId: "1:766363119746:web:1c63801fe2218ed224449b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const SABORES = ["Tradicional", "Beijinho", "Ferrero", "Lim√£o", "Caf√©", "Maracuj√°"];
    let comboTemp = [];
    let prontaTemp = null;
    let autenticado = false;

    const combosFixos = [
        { n: "2 Ferreros e 2 Tradicionais", s: ["Ferrero", "Ferrero", "Tradicional", "Tradicional"] },
        { n: "2 Beijinhos e 2 Brigadeiros", s: ["Beijinho", "Beijinho", "Tradicional", "Tradicional"] },
        { n: "4 Tradicionais", s: ["Tradicional", "Tradicional", "Tradicional", "Tradicional"] }
    ];

    function abrirAba(e, id) {
        if (id === 'aba-admin' && !autenticado) {
            if (prompt("PIN:") === "1808") { autenticado = true; } else { return; }
        }
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
    }

    function render() {
        document.getElementById('lista-pronta').innerHTML = combosFixos.map(c => `
            <div class="card-item">
                <input type="radio" name="escolha-pronta" onchange="selecionarPronta('${c.n}', ${JSON.stringify(c.s)})">
                <span style="flex:1; margin-left:10px"><strong>${c.n}</strong></span>
                <span>R$ 10,00</span>
            </div>
        `).join('');

        document.getElementById('grid-combo').innerHTML = SABORES.map(s => `
            <button class="tab-btn" style="background:white; border:1px solid #ddd" onclick="escolherCombo('${s}')">+ ${s}</button>
        `).join('');
    }

    function selecionarPronta(nome, sabores) {
        prontaTemp = { nome, sabores, preco: 10 };
        validar('pronta');
    }

    function escolherCombo(s) {
        if(comboTemp.length < 4) {
            comboTemp.push(s);
            document.getElementById('selecionados-label').innerText = `Selecionados: ${comboTemp.length}/4 (${comboTemp.join(', ')})`;
            validar('combo');
        } else {
            alert("Limite de 4 doces atingido. Recarregue para mudar.");
        }
    }

    function validar(tipo) {
        const nome = document.getElementById(`nome-${tipo}`).value;
        const entrega = document.getElementById(`entrega-${tipo}`).value;
        const btn = document.getElementById(`btn-${tipo}`);
        
        if(tipo === 'pronta') {
            btn.disabled = !(nome.length > 2 && entrega !== "" && prontaTemp !== null);
        } else {
            btn.disabled = !(nome.length > 2 && entrega !== "" && comboTemp.length === 4);
        }
    }

    async function finalizar(tipo) {
        const nome = document.getElementById(`nome-${tipo}`).value;
        const entrega = document.getElementById(`entrega-${tipo}`).value;
        let item = tipo === 'pronta' ? prontaTemp : { nome: "Combo Personalizado", sabores: comboTemp, preco: 10 };

        try {
            await db.collection("pedidos").add({
                cliente: nome, entrega: entrega, itens: [item], status: "pendente", data: new Date()
            });

            let msg = `*Amor e Cacau*%0A*Nome:* ${nome}%0A*Entrega:* ${entrega}%0A*Pedido:* ${item.nome}%0A*Sabores:* ${item.sabores.join(', ')}`;
            window.open(`https://wa.me/5519992483488?text=${msg}`);
            
            // Limpa ap√≥s enviar
            if(tipo === 'combo') comboTemp = [];
            document.getElementById(`nome-${tipo}`).value = "";
            render();
        } catch (e) { alert("Erro ao enviar."); }
    }

    // LISTENER DE PRODU√á√ÉO (ADMIN)
    db.collection("pedidos").where("status", "==", "pendente").onSnapshot((snapshot) => {
        let totais = {}; SABORES.forEach(s => totais[s] = 0);
        let htmlP = "";
        snapshot.forEach(doc => {
            const p = doc.data();
            p.itens.forEach(it => it.sabores.forEach(s => totais[s]++));
            htmlP += `<div class="card-item" style="flex-direction:column; align-items:flex-start">
                <strong>${p.cliente}</strong> <small>${p.entrega} - ${p.itens[0].nome}</small>
                <button class="btn-acao" style="width:100%; margin-top:10px; background:var(--verde-wpp)" onclick="db.collection('pedidos').doc('${doc.id}').update({status:'ok'})">Pronto</button>
            </div>`;
        });
        document.getElementById('resumo-producao').innerHTML = SABORES.map(s => `
            <div style="display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px dashed #ccc">
                <span>${s}</span> <strong>${totais[s]} un</strong>
            </div>
        `).join('');
        document.getElementById('pedidos-lista-admin').innerHTML = htmlP || "Nenhum pedido pendente.";
    });

    render();
</script>
</body>
</html>
