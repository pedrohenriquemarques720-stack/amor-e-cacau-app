<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amor e Cacau | Pedidos</title>
    <style>
        :root {
            --cor-vinho: #800020;
            --marrom-chocolate: #4b2e2e;
            --bege-logo: #f7ede2;
            --verde-wpp: #25d366;
            --cor-esgotado: #999;
        }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bege-logo); color: var(--marrom-chocolate); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .tabs-nav { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn { flex: none; padding: 10px 15px; border: none; background: #f0f0f0; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .tab-btn.active { background: var(--cor-vinho); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .carrinho-global { background: #fffcf0; border: 1px solid #e6dbb9; padding: 15px; border-radius: 15px; margin-top: 25px; display: none; }
        .carrinho-global.visible { display: block; }
        .carrinho-item { display: flex; justify-content: space-between; align-items: flex-start; font-size: 0.85rem; margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px solid #f0e6c8; }
        .btn-remover { color: red; background: none; border: none; cursor: pointer; font-size: 0.7rem; padding: 0 5px; }
        .cardapio-floral { text-align: center; padding: 20px; border: 2px solid var(--bege-logo); border-radius: 20px; background: #fffcf9; }
        .box-display { background: #fffafa; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center; border: 1px solid #f0e0e0; }
        .slots-container { display: flex; justify-content: center; gap: 8px; margin-top: 10px; }
        .slot { width: 55px; height: 55px; border: 2px dashed var(--cor-vinho); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; background: white; cursor: pointer; }
        .slot.filled { border: 2px solid var(--cor-vinho); background: var(--cor-vinho); color: white; font-weight: bold; }
        .grid-botoes { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-item { background: white; border: 1.5px solid var(--cor-vinho); color: var(--cor-vinho); padding: 12px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        .item-escala { display: flex; align-items: center; justify-content: space-between; padding: 10px; border: 1px solid #eee; border-radius: 12px; margin-bottom: 8px; background: #fff; }
        .btn-ctrl { background: var(--cor-vinho); color: white; border: none; width: 28px; height: 28px; border-radius: 50%; font-weight: bold; cursor: pointer; }
        .card-fixo { display: flex; align-items: center; padding: 12px; border: 1px solid #eee; border-radius: 15px; margin-bottom: 10px; cursor: pointer; }
        .card-fixo.selected { border: 2px solid var(--cor-vinho); background: #fff5f7; }
        .bolinha-selecao { width: 22px; height: 22px; border: 2px dashed var(--cor-vinho); border-radius: 50%; margin-right: 15px; flex-shrink: 0; }
        .card-fixo.selected .bolinha-selecao { border-style: solid; background: var(--cor-vinho); position: relative; }
        .card-fixo.selected .bolinha-selecao::after { content: '‚úì'; color: white; font-size: 12px; position: absolute; left: 5px; top: 1px; }
        .btn-wpp { width: 100%; background: var(--verde-wpp); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; opacity: 0.5; pointer-events: none; }
        .btn-wpp.liberado { opacity: 1; pointer-events: auto; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; }
        .estoque-item { display: flex; align-items: center; justify-content: space-between; background: #fff; padding: 15px; border-radius: 15px; border: 1px solid #eee; margin-bottom: 10px; }
        .btn-baixa { background: var(--cor-vinho); color: white; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-baixa:disabled { background: #ccc; }
    </style>
</head>
<body>
<div class="container">
    <header style="text-align: center; margin-bottom: 20px;">
        <h1 style="color: var(--cor-vinho); margin: 0;">‚ù§Ô∏è Amor e Cacau</h1>
    </header>

    <div class="tabs-nav">
        <button class="tab-btn active" onclick="abrirAba(event, 'aba-cardapio')">Card√°pio</button>
        <button class="tab-btn" onclick="abrirAba(event, 'aba-pronta')">Pronta Entrega</button>
        <button class="tab-btn" onclick="abrirAba(event, 'aba-combo')">Monte seu Combo</button>
        <button class="tab-btn" style="background: #eef2ff;" onclick="abrirAba(event, 'aba-estoque')">üì¶ Estoque</button>
    </div>

    <div id="aba-cardapio" class="tab-content active">
        <div class="cardapio-floral">
            <h2 style="color: var(--cor-vinho)">Sabores de Amanh√£</h2>
            <p>Tradicional ‚Ä¢ Beijinho ‚Ä¢ Lim√£o ‚Ä¢ Caf√© ‚Ä¢ Maracuj√°</p>
            <ul style="list-style: none; padding: 0; font-weight: bold;">
                <li>üì¶ Caixinha (4 un): R$ 10,00</li>
                <li>üéâ Cento (100 un): R$ 120</li>
            </ul>
        </div>
    </div>

    <div id="aba-pronta" class="tab-content">
        <h3 style="color: var(--cor-vinho)">üöö Combos Prontos</h3>
        <div id="lista-combos-fixos"></div>
    </div>

    <div id="aba-combo" class="tab-content">
        <h4 style="color: var(--cor-vinho)">üéÅ Monte sua Caixinha (4 un)</h4>
        <div class="box-display">
            <span id="contador-texto" style="font-weight: bold; font-size: 0.9rem;">Caixinha (0/4):</span>
            <div class="slots-container" id="slots-area"></div>
            <button id="btn-add-caixa" style="background:var(--cor-vinho); color:white; border:none; width:100%; padding:12px; border-radius:12px; margin-top:10px; font-weight:bold; display:none;" onclick="adicionarCaixaMontada()">Adicionar ao Pedido</button>
        </div>
        <div class="grid-botoes" id="botoes-sabores"></div>
        <h4 style="color: var(--cor-vinho); margin-top: 30px;">üéâ Monte seu Cento</h4>
        <div id="lista-escala-cento"></div>
    </div>

    <div id="aba-estoque" class="tab-content">
        <h3 style="color: var(--cor-vinho)">üì¶ Baixa de Estoque</h3>
        <div id="lista-estoque-manual"></div>
        <button onclick="resetarEstoqueManual()" style="width: 100%; padding: 10px; background: #eee; border: 1px solid #ddd; border-radius: 10px; font-size: 0.8rem; margin-top:20px; cursor:pointer;">üîÑ Reiniciar Tudo</button>
    </div>

    <div id="carrinho-global" class="carrinho-global">
        <h4 style="margin: 0 0 10px 0; color: var(--cor-vinho);">üõí Seu Pedido</h4>
        <div id="itens-carrinho"></div>
        <div style="border-top: 2px solid #e6dbb9; margin-top: 10px; padding-top: 10px; font-weight: bold; display: flex; justify-content: space-between;">
            <span>Total:</span> <span id="valor-total">R$ 0,00</span>
        </div>
        <input type="text" id="nome-cliente" placeholder="Seu Nome" style="margin-top:10px;" oninput="validarPedido()">
        <select id="entrega-cliente" onchange="validarPedido()">
            <option value="">Como vai receber?</option>
            <option value="Retirada">Retirada</option>
            <option value="Uber Moto">Uber Moto</option>
        </select>
        <button id="btn-finalizar" class="btn-wpp" onclick="enviarPedido()">Pedir no WhatsApp</button>
    </div>
</div>

<script>
    const SABORES = ["Tradicional", "Beijinho", "Lim√£o", "Caf√©", "Maracuj√°"];

    const ESTOQUE_INICIAL = {
        "Combo Tropical (Marac/Lim√£o)": 4,
        "Combo Chocolatudo (Tradicional)": 4,
        "Combo Turbo (Trad/Caf√©)": 2,
        "Combo Festa (Trad/Beijinho)": 3,
        "Combo Misto (Variados)": 3,
        "Combo Chocolima (Lim√£o/Trad)": 2,
        "Combo Caf√© Azedo": 4,
        "Combo Maracublack (Trad/Marac)": 2
    };

    const COMBOS_FIXOS = [
        { n: "Combo Tropical (2x Marac, 2x Lim√£o)", s: ["Maracuj√°","Maracuj√°","Lim√£o","Lim√£o"] },
        { n: "Combo Chocolatudo (4x Tradicional)", s: ["Tradicional","Tradicional","Tradicional","Tradicional"] },
        { n: "Combo Turbo (2x Trad, 2x Caf√©)", s: ["Tradicional","Tradicional","Caf√©","Caf√©"] },
        { n: "Combo Festa (2x Trad, 2x Beijinho)", s: ["Tradicional","Tradicional","Beijinho","Beijinho"] },
        { n: "Combo Misto (Variados)", s: ["Tradicional","Beijinho","Lim√£o","Maracuj√°"] },
        { n: "Combo Chocolima (2x Lim√£o, 2x Trad)", s: ["Lim√£o","Lim√£o","Tradicional","Tradicional"] },
        { n: "Combo Caf√© Azedo", s: ["Caf√©","Caf√©","Maracuj√°","Maracuj√°"] },
        { n: "Combo Maracublack (2x Trad, 2x Marac)", s: ["Tradicional","Tradicional","Maracuj√°","Maracuj√°"] }
    ];

    let meuEstoque = JSON.parse(localStorage.getItem('amorECacauEstoque')) || { ...ESTOQUE_INICIAL };
    let carrinho = []; let caixaAtual = [];
    let escalaCento = {}; SABORES.forEach(s => escalaCento[s] = 0);
    let autenticado = false;

    function abrirAba(e, id) {
        if (id === 'aba-estoque' && !autenticado) {
            let pin = prompt("PIN:");
            if (pin === "1808") { autenticado = true; } else return;
        }
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.currentTarget.classList.add('active');
        if(id === 'aba-estoque') renderEstoqueManual();
    }

    function renderEstoqueManual() {
        const container = document.getElementById('lista-estoque-manual');
        if(!container) return;
        container.innerHTML = "";
        for (let item in meuEstoque) {
            const qtd = meuEstoque[item];
            container.innerHTML += `
                <div class="estoque-item" style="${qtd <= 0 ? 'opacity: 0.5' : ''}">
                    <div style="flex:1"><strong>${item}</strong><br><small>${qtd} un</small></div>
                    <button class="btn-baixa" onclick="darBaixa('${item}')" ${qtd <= 0 ? 'disabled' : ''}>VENDI -1</button>
                </div>`;
        }
    }

    function darBaixa(item) {
        if (meuEstoque[item] > 0) {
            meuEstoque[item]--;
            localStorage.setItem('amorECacauEstoque', JSON.stringify(meuEstoque));
            renderEstoqueManual();
        }
    }

    function resetarEstoqueManual() {
        if (confirm("Resetar estoque para amanh√£?")) {
            meuEstoque = { ...ESTOQUE_INICIAL };
            localStorage.setItem('amorECacauEstoque', JSON.stringify(meuEstoque));
            renderEstoqueManual();
        }
    }

    function renderCombosFixos() {
        const div = document.getElementById('lista-combos-fixos');
        if(!div) return;
        div.innerHTML = COMBOS_FIXOS.map((c, i) => {
            const sel = carrinho.find(it => it.tipo === 'pronta' && it.index === i);
            return `<div class="card-fixo ${sel ? 'selected' : ''}" onclick="toggleComboFixo(${i})"><div class="bolinha-selecao"></div><div>${c.n}</div></div>`;
        }).join('');
    }

    function toggleComboFixo(i) {
        const idx = carrinho.findIndex(it => it.tipo === 'pronta' && it.index === i);
        if (idx > -1) carrinho.splice(idx, 1);
        else carrinho.push({ tipo: 'pronta', index: i, nome: "Combo", desc: COMBOS_FIXOS[i].n, preco: 10 });
        renderCombosFixos(); renderCarrinho();
    }

    function atualizarSlots() {
        const area = document.getElementById('slots-area');
        if(!area) return;
        area.innerHTML = '';
        for(let i=0; i<4; i++) {
            const s = document.createElement('div');
            s.className = caixaAtual[i] ? 'slot filled' : 'slot';
            s.innerHTML = caixaAtual[i] || '';
            s.onclick = () => { if(caixaAtual[i]) { caixaAtual.splice(i, 1); atualizarSlots(); } };
            area.appendChild(s);
        }
        document.getElementById('contador-texto').innerText = `Caixinha (${caixaAtual.length}/4):`;
        document.getElementById('btn-add-caixa').style.display = caixaAtual.length === 4 ? 'block' : 'none';
    }

    function adicionarCaixaMontada() {
        carrinho.push({ tipo: 'caixa', nome: "Caixa Montada", desc: caixaAtual.join(', '), preco: 10 });
        caixaAtual = []; atualizarSlots(); renderCarrinho();
    }

    function renderEscala() {
        const div = document.getElementById('lista-escala-cento');
        if(!div) return;
        div.innerHTML = SABORES.map(s => `
            <div class="item-escala">
                <span>25x ${s}</span>
                <div>
                    <button class="btn-ctrl" onclick="mudarEscala('${s}', -1)">-</button>
                    <span style="margin: 0 8px;">${escalaCento[s]}</span>
                    <button class="btn-ctrl" onclick="mudarEscala('${s}', 1)">+</button>
                </div>
            </div>`).join('');
        
        carrinho = carrinho.filter(it => it.tipo !== 'cento');
        const totalP = Object.values(escalaCento).reduce((a,b)=>a+b, 0);
        if (totalP > 0) {
            let v = totalP === 1 ? 50 : totalP === 2 ? 70 : totalP === 3 ? 100 : 120 + ((totalP-4)*30);
            carrinho.push({ tipo: 'cento', nome: "Cento", desc: `${totalP*25} unidades`, preco: v });
        }
        renderCarrinho();
    }

    function mudarEscala(s, d) { if (!(d===-1 && escalaCento[s]===0)) { escalaCento[s]+=d; renderEscala(); } }

    function renderCarrinho() {
        const cartDiv = document.getElementById('carrinho-global');
        const itensDiv = document.getElementById('itens-carrinho');
        if (carrinho.length > 0) {
            cartDiv.classList.add('visible');
            let total = 0;
            itensDiv.innerHTML = carrinho.map((it, idx) => {
                total += it.preco;
                return `<div class="carrinho-item"><div><strong>${it.nome}</strong><br><small>${it.desc}</small></div><div>R$ ${it.preco},00 <button class="btn-remover" onclick="removerItem(${idx})">‚úï</button></div></div>`;
            }).join('');
            document.getElementById('valor-total').innerText = `R$ ${total},00`;
        } else { cartDiv.classList.remove('visible'); }
        validarPedido();
    }

    function removerItem(idx) {
        if (carrinho[idx].tipo === 'cento') { SABORES.forEach(s => escalaCento[s] = 0); renderEscala(); }
        else { carrinho.splice(idx, 1); renderCombosFixos(); }
        renderCarrinho();
    }

    function validarPedido() {
        const n = document.getElementById('nome-cliente').value;
        const e = document.getElementById('entrega-cliente').value;
        const btn = document.getElementById('btn-finalizar');
        btn.classList.toggle('liberado', n.length > 2 && e !== "" && carrinho.length > 0);
    }

    function enviarPedido() {
        const nome = document.getElementById('nome-cliente').value;
        const entrega = document.getElementById('entrega-cliente').value;
        let msg = `*Amor e Cacau*\n*Nome:* ${nome}\n*Entrega:* ${entrega}\n\n`;
        let total = 0;
        carrinho.forEach(it => { msg += `‚Ä¢ ${it.nome}: ${it.desc}\n`; total += it.preco; });
        msg += `\n*Total: R$ ${total},00*`;
        window.location.href = `https://api.whatsapp.com/send?phone=5519992483488&text=${encodeURIComponent(msg)}`;
    }

    // INICIALIZA√á√ÉO OBRIGAT√ìRIA
    window.onload = function() {
        renderCombosFixos(); 
        renderEscala(); 
        atualizarSlots();
        document.getElementById('botoes-sabores').innerHTML = SABORES.map(s => `<button class="btn-item" onclick="if(caixaAtual.length<4){caixaAtual.push('${s}');atualizarSlots();} ">+ ${s}</button>`).join('');
    };
</script>
</body>
</html>
